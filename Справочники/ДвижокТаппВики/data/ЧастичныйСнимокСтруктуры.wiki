++ Частичный Снимок Структуры
[template: ШаблонКарточкиГлоссария]
Состояние: [В РАЗРАБОТКЕ]

ЧастичныйСнимокСтруктуры содержит некоторый УчастокСтруктурыСущностей, объединенный неким смыслом.


+++Версии
* todo.глоссарий.форма: Создайте новую страницу для версии описания сущности, добавив к имени "Версия0". Так осуществляется поддержка версий страниц глоссария. 

+++Обязанности
* todo.глоссарий.форма: Перечислите обязанности сущности здесь.
* 

+++Сущности предметной области
* todo.глоссарий.форма: Перечислите выявленные сущности предметной области здесь.
* 

+++Соответствующий класс кода
 todo.глоссарий.форма: Укажите здесь соответствующий класс кода проекта, если известен.
++++Свойства - данные
++++Методы

+++Дополнительная информация 
* ТемаЧастичныйСнимокСтруктуры
* ЧастичныйСнимокСтруктуры содержит некоторый УчастокСтруктурыСущностей, объединенный неким смыслом. Такой снимок может храниться как ресурс.
* При загрузке эта часть добавляется к уже существующей СтруктураСущностей. Нужно согласовывать структуру, это усложняет загрузку и может окончиться неудачей.
* [//В РАЗРАБОТКЕ] - разработать теорию про загрузку СтруктураСущностей из [Снимок].
ЧастичныйСнимокСтруктуры представляет собой копию УчастокСтруктурыСущностей [Солюшен]а. ЧастичныйСнимокСтруктуры предназначен для экспорта части СтруктураСущностей в другие солюшены или для создания снимка СнимокРесурс.
ЧастичныйСнимокСтруктуры включает в себя как временные так и постоянные ячейки. Удобно использовать временные ячейки, но они также будут связываться с постоянными ячейками внутри и вне сериализуемого УчастокСтруктурыСущностей. Частичный снимок не должен ссылаться на внешние временные ячейки, так как это приведет к рассогласованию СтруктураСущностей. Таким образом, частичный снимок должен включать в себя все временные ячейки, на которые ссылаются ячейки, находящиеся внутри УчастокСтруктурыСущностей.
* При выгрузке снимка в файл необходимо каким-то образом определить сериализуемый УчастокСтруктурыСущностей и отличить ячейки, помещаемые в снимок, от остальных ячеек в СтруктураСущностей. 
* При загрузке снимка из файла необходимо проверить, что ячейки, на которые ссылаются ячейки в снимке, соответствуют по состоянию ячейкам, существующим в СтруктураСущностей. Поэтому в снимке предлагается также хранить хеши (ИД и имена?) ВнешняяЯчейка  ячеек (или целиком эти ячейки, для удобства контроля различий), при десериализации проверять наличие и состояние ячеек и выдавать предупреждения. Иначе при несовпадении версий (См. ВерсияДанныхСтруктурыСущностей) могут быть неочевидные ошибки.
Предполагается, что ВерсияАрхитектурыСтруктурыСущностей снимка совпадает с солюшеном. Хотя это надо проверять.

ЧастичныйСнимокСтруктуры предполагает резервирование идентификаторов находящихся в нем ячеек, чтобы исключить конфликты идентификаторов ячеек при загрузке. Это не позволяет проводить дефрагментацию пространств идентификаторов. Или же при загрузке нужно будет переделывать идентификаторы ячеек снимка, это делает неудобным адресацию ячеек в методах.
    * Получается, формируем список ячеек для снимка, список их связей (в единственном экземпляре), список связанных ячеек — для вычисления хешей.
При десериализации нужно проверять и согласовывать идентификаторы ячеек, при необходимости заменять их, если уже заняты.

Из ИконкиЯчеекВНавигаторе:
    * ЧастичныйСнимокСтруктуры контейнера не включает в себя информацию о иконках ИконкаЯчейки, поэтому она может теряться. Зато это позволяет избежать проблемы с несовпадением иконок в разных СнимокСтруктуры.

++++Создание частичного снимка.
Для создания ЧастичныйСнимокСтруктуры нужен СписокЭкспортируемыхЯчеекСнимка.
Создается СписокВнешнихЯчеекСнимка. Этот список содержит все ячейки, не указанные в СписокЭкспортируемыхЯчеекСнимка, чьи идентификаторы есть в свойствах экспортируемых ячеек и их связей. Просматриваются ячейки из СписокЭкспортируемыхЯчеекСнимка и связи этих ячеек.
Если СписокВнешнихЯчеекСнимка большой, согласовать структуру будет сложно. Надо, чтобы экспортируемый УчастокСтруктурыСущностей был практически отдельной от общей СтруктураСущностей.

Эти экспортируемые ячейки перечисляются в СекцияВнешнихЯчеек снимка. При импорте данные этих ячеек сравниваются с данными ячеек СтруктураСущностей и все несовпадающие ячейки представляются пользователю на согласование. Пользователь должен согласовать СтруктураСущностей.

Затем экспортируемые ячейки перечисляются в секции ячеек, а связи - в секции связей снимка.

Опционально, после создания снимка можно удалить экспортируемые ячейки из [Солюшен]а. Соответственно, удалить и связи ячеек.
При этом, если ничего не изменится в структуре [Солюшен]а, то при загрузке этого же снимка он должен встать на место как и был.
Идентификаторы ИдентификаторЯчейки при создании снимка не изменяются.

++++Загрузка частичного снимка
Сначала читается СписокВнешнихЯчеекСнимка. 
Согласовать внешние ячейки снимка с существующими в СтруктураСущностей. Пользователь должен определить, соответствует ли указанная в снимке ячейка ячейке, существующей в СтруктураСущностей. Если полное соответствие по ИдентификаторЯчейки и данным, то можно ее считать соответствующей.
Пользователю, однако, надо представить список всех внешних ячеек, автосогласованных и не согласованных. Пользователь может указать в качестве внешней некоторую ячейку СтруктураСущностей, или создать эту ячейку как часть импортированной СтруктураСущностей.
Конечно, проще всего будет иметь некоторый *стандарт структуры*, и по нему создавать снимки, но пока такого стандарта нет.
Хотя по одной ячейке трудно определить, какую роль она играет в СтруктураСущностей, поэтому лучше было бы загрузить сразу всю СтруктураСущностей, а потом уже согласовывать ее. Однако пользователь может просто создать такую ячейку и потом уже, после загрузки всего снимка, согласовать СтруктураСущностей и заменить ячейку на соответствующую.

Создать СловарьТрансляцииИдентификаторовЯчеек. Это словарь, в котором ИдентификаторЯчейки в СтруктураСущностей сопоставлен идентификатору ячейки в снимке. Туда помещаются все идентификаторы внешних ячеек.

Далее загрузка ячеек снимка. Каждая ячейка снимка копируется в СтруктураСущностей, ее старый и новый идентификаторы вносятся в СловарьТрансляцииИдентификаторовЯчеек. После копирования всех ячеек, когда СловарьТрансляцииИдентификаторовЯчеек уже полон, в каждой новой ячейке в свойствах надо заменить старые идентификаторы на новые.

Далее загрузка связей снимка. Связи создаются в соответствии с трансляцией идентификаторов ячеек. То есть, берутся старые идентификаторы, транслируются в новые, создается связь между этими ячейками, вписываются свойства и новые идентификаторы вместо старых.

+++++Замечания
* При загрузке ячеек из снимка хорошо бы создавать *список ячеек, загруженных из снимка*, чтобы потом их проще было отличать от других.
    * Для чего их отличать от других? В ЧастичныйСнимокСтруктуры только? 
* Надо сохранять в снимок КлассЯчейки при создании снимка, а потом соответственно восстанавливать обратно.
    * todo.концепция.снимки: Надо составить список вариантов загрузок ячеек из снимка со сменой КлассЯчейки, и оценить, зачем это нужно и как все это выглядит. Например: из MCellBt в MCellA: зачем это надо и как это сделать? 
        * Да вроде бы не надо - ведь должна получиться точная копия СтруктураСущностей. 

++++Сериализация Частичный снимок:
Для сериализации надо выделить СписокЭкспортируемыхЯчеекСнимка из СтруктураСущностей - Создать список идентификаторов ячеек будущего снимка. Проверить, что все внешние по отношению к будущему снимку ячейки постоянные. Временные внешние ячейки надо либо включить в список, либо запросить пользователя. Эти ячейки связаны с ячейками будущего снимка, поэтому их связи останутся в снимке — будут проблемы при загрузке снимка.
Внешние ячейки перечисляются в СекцияВнешнихЯчеек снимка. 

При десериализации элементы снимка вписываются в существующую СтруктураСущностей. При этом нужно согласовать идентификаторы, проверить совпадение внешних ячеек, ...

Получается, формируем СписокЭкспортируемыхЯчеекСнимка, *список их связей* (в единственном экземпляре), СписокВнешнихЯчеекСнимка — для вычисления хешей.
При десериализации нужно проверять и согласовывать идентификаторы ячеек, при необходимости заменять их, если уже заняты.        