++ Полный Снимок Структуры
[template: ШаблонКарточкиГлоссария]
Состояние: [В РАЗРАБОТКЕ]

ПолныйСнимокСтруктуры содержит всю СтруктураСущностей [Солюшен]а.


+++Версии
* todo.глоссарий.форма: Создайте новую страницу для версии описания сущности, добавив к имени "Версия0". Так осуществляется поддержка версий страниц глоссария. 

+++Обязанности
* todo.глоссарий.форма: Перечислите обязанности сущности здесь.
* 

+++Сущности предметной области
* todo.глоссарий.форма: Перечислите выявленные сущности предметной области здесь.
* 

+++Соответствующий класс кода
 todo.глоссарий.форма: Укажите здесь соответствующий класс кода проекта, если известен.
++++Свойства - данные
* Дата Создания снимка
* 
++++Методы

+++Дополнительная информация 
* ПолныйСнимокСтруктуры может использоваться для страховки ТранзакцияСолюшена, импорта/экспорта [Солюшен]а.
Значение шага хранится в контейнере и увеличивается при каждом сохранении ПолныйСнимокСтруктуры.
[Контейнер] обычно содержит только часть СтруктураСущностей, но в ПолныйСнимокСтруктуры записывается вся СтруктураСущностей полностью.
* ПолныйСнимокСтруктуры содержит всю СтруктураСущностей [Солюшен]а. Полный снимок представляет собой копию структуры, и при его загрузке создается новая база данных. Поэтому он должен содержать всю необходимую информацию.
* Полный снимок представляет собой моментальную копию *всех* ячеек и связей из памяти и БазаДанныхСолюшена. Эти ячейки и связи извлекаются из КоллекцияЯчеекКонтейнера и КоллекцияСвязейКонтейнера и из БазаДанныхСолюшена.
Таким образом, будет сериализована полная копия Солюшена.
Если СолюшенБезБД, когда в солюшене нет БазаДанныхСолюшена, то из БазаДанныхСолюшена не берем ничего.
При десериализации нужно сначала создать новую БазаДанныхСолюшена (если она должна существовать в солюшене согласно данным снимка), затем набить ее данными согласно снимку. 
На выходе процесса десериализации должен быть [Контейнер] в том же состоянии, что и на момент создания снимка.

++++Процесс сериализации полного снимка:
Создается файл ПолныйСнимокСтруктуры имясолюшена.шаг.расширение в КаталогСнимковСолюшена.
В файл пишется СигнатураФайлаСнимка 8байт. Затем записывается ЗаголовокСнимка, содержащая информацию о солюшене и снимке, число ячеек и связей. Затем пишется СекцияКонтейнера, содержащая состояние [Контейнер]а. Затем идут *секции ячеек* — из памяти, из таблицы, связанных ячеек. Вывод ячеек и связей должен использовать небольшой объем памяти, поскольку в основном память уже занимает существующая СтруктураСущностей. Для вывода ячеек и связей из таблиц используется АлгоритмСтупенчатогоПониженияРазмераВыборкиПриНедостаткеПамяти. 
Каждая секция имеет длину и контрольную сумму. Секции связей и ячеек имеют счетчики элементов. Секции элементов в секциях следуют друг за другом. Их количество хранится в секции.
Сначала сериализуются ячейки. 
Все ячейки из памяти записываются в СекцияЯчеекВПамяти. Эта часть снимка хранит состояние СтруктураСущностей в памяти на момент создания снимка — состояние ячеек MCellBt и MCellBds, присутствие ячеек в памяти итд. 
Все ячейки из ТаблицаЯчеекБд записываются в СекцияЯчеекВБд. Эта часть снимка хранит постоянные ячейки СтруктураСущностей.
Если в СтруктураСущностей участвуют ячейки ВнешняяЯчейка — находящиеся в другом контейнере — они записываются в СекцияВнешнихЯчеек. Это позволяет при десериализации проверять состояние таких ячеек, и выдавать предупреждения о проблемах совместимости версий СтруктураСущностей. Ячейки пишутся полностью, хотя, конечно, не все их поля важны, переделывать и усложнять формат снимка будем потом.
СписокВнешнихЯчеекСнимка можно получить из КоллекцияСвязейКонтейнера и ТаблицаСвязейБд, выделяя их по ИдентификаторСолюшена. В прошлой версии движка ИдентификаторСолюшена не применялся, поэтому внешних ячеек нет, и СекцияВнешнихЯчеек в ПолныйСнимокСтруктуры была пустой.
Связи сериализуются подряд, без разделения на постоянные и временные. Из КоллекцияСвязейКонтейнера берутся только временные связи, из ТаблицаСвязейБд — постоянные связи. 

Завершает файл байт описания СекцияКонцаФайла.

++++Десериализация полного снимка:
Задача — восстановить исходное состояние СтруктураСущностей в памяти и таблице. Для этого надо очистить таблицы БД или вообще удалить и создать заново. Вероятно, после загрузки потребуется перестроить индексы таблиц БазаДанныхСолюшена. Из этого следует, что в коде не должны использоваться значения, производные от переменных состояния БазаДанныхСолюшена, так как при загрузке снимка они будут отличаться.
Сначала десериализуются ячейки. Удобно десериализовать сначала ячейки в памяти — меньше переделывать, если пользователь отменит операцию, и проще контролировать ошибки десериализации — доступ к несуществующей записи в таблице. Хотя СтруктураСущностей может занимать много памяти, надо подумать...
Ячейки в память восстанавливаются в исходном виде. Необходимо обходить встроенные в объекты класса ячейки процедуры записи новых значений в ТаблицаЯчеекБд.
Ячейки в ТаблицаЯчеекБд восстанавливаются последовательно друг за другом.
ВнешняяЯчейка ячейки должны проверяться на совпадение состояния, если не совпадают, пользователь должен разобраться и принять решение.
Связи десериализуются после создания ячеек. Временные связи помещаются в КоллекцияСвязейКонтейнера и КоллекцияСвязейЯчейки самих связанных ячеек. Постоянные связи сначала записываются в ТаблицаСвязейБд, потом из ТаблицаСвязейБд получают новый ИдентификаторСвязи, затем проверяют наличие ячеек в памяти и соответственно записываются в КоллекцияСвязейКонтейнера и КоллекцияСвязейЯчейки.
+++++Замечания
* При загрузке ячеек из снимка хорошо бы создавать *список ячеек, загруженных из снимка*, чтобы потом их проще было отличать от других.
    * Для чего их отличать от других? В ЧастичныйСнимокСтруктуры только? 
* Надо сохранять в снимок КлассЯчейки при создании снимка, а потом соответственно восстанавливать обратно.
    * todo.концепция.снимки: Надо составить список вариантов загрузок ячеек из снимка со сменой КлассЯчейки, и оценить, зачем это нужно и как все это выглядит. Например: из MCellBt в MCellA: зачем это надо и как это сделать? 
        * Да вроде бы не надо - ведь должна получиться точная копия СтруктураСущностей. 